pipeline {
    agent any

    stages {
        stage('Send Email') {
            steps {
                script {
                    def retryCount = 1
                    def maxRetries = 2
                    def response = retry(maxRetries) {
                        // Attempt to send email
                        def emailResponse = emailext (
                            subject: 'Test Email',
                            body: 'This is a test email.',
                            to: 'raju.thanga@gmail.com'
                        )
                        // Check if email sending was successful
                        if (emailResponse != 'SENT') {
                            // If not successful, throw an exception to trigger retry
                            throw new Exception("Failed to send email")
                        }
                        // Return the response if successful
                        return emailResponse
                    }
                    // If email sending was successful after retrying
                    echo 'Email sent successfully'
                    // Add your next steps here
                }
            }
        }
    }
}
